var gameLogic;!function(a){function b(a,b){return JSON.stringify(a)===JSON.stringify(b)}function c(a){return JSON.parse(JSON.stringify(a))}function d(a,b){return o[a][b]}function e(a){for(var b=0;11>b;++b)for(var c=0,d=o[b][0];d<o[b][1];++d)if(""!==a[b][d]&&(0===d||a[b][d-1]===a[b][d]?c++:c=1,c===n))return a[b][d];for(var d=0;10>d;++d)for(var c=0,b=p[d][0];b<p[d][1];++b)if(""!==a[b][d]&&(0===b||a[b-1][d]===a[b][d]?c++:c=1,c===n))return a[b][d];for(var e,f,b=0;10>b;++b){var c=0;for(e=q[b][0],f=q[b][1];11>e&&10>f;e++,f++)if(""!==a[e][f]&&(0===e||0===f||a[e][f]===a[e-1][f-1]?c++:c=1,c===n))return a[e][f]}return""}function f(a){for(var b=0;11>b;++b)for(var c=o[b][0];c<o[b][1];++c)if(""===a[b][c])return!1;return!0}function g(a,b,d,g,h,i,j){if(void 0===a&&(a=l()),""!==a[b][d])throw new Error("One can only make a move in an empty position!");var k=c(a);k[b][d]=0===j?"R":"Y",0!==i&&(k[b+g*i][d+h*i]="");var m=e(k),n={};return n=""!==m||f(k)?{endMatch:{endMatchScores:"R"===m?[1,0]:"Y"===m?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-j}},[n,{set:{key:"board",value:k}},{set:{key:"delta",value:{row:b,col:d,delDirRow:g,delDirCol:h,delDis:i}}}]}function h(a){var c=a.move,d=a.turnIndexBeforeMove,e=a.stateBeforeMove;try{var f=c[2].set.value;console.log("isMoveOk[0-0-1] move[2]="+JSON.stringify(c[2])),console.log("isMoveOk[0-0-1] deltaValue="+JSON.stringify(f)),console.log("isMoveOk[0-0-2]");var h=f.row,i=f.col,j=f.delDirRow,k=f.delDirCol,m=f.delDis,n=e.board,p=e.delta,q=-1;if(p&&(q=p.delDis),void 0===n&&(n=l()),0!==m&&0!==q&&j===h&&k===i)return!1;if(0!==m){if(m>2||0>m)return!1;if(0>h+3*j||0>i+3*k)return!1;if(n[h+j][i+k]!==(0===d?"Y":"R"))return!1;if(n[h+2*j][i+2*k]!==(0===d?"Y":"R"))return!1;if(n[h+3*j][i+3*k]!==(0===d?"R":"Y"))return!1}var r=g(n,h,i,j,k,m,d);if(!b(c,r))return!1;if(0>h||h>10)return!1;if(o[h][0]>i||o[h][1]<=i)return!1}catch(s){return!1}return!0}function i(a,b,c){for(var d=[],e=b,f=a,h=0;h<c.length;h++){var i=c[h],j=g(e.board,i.row,i.col,i.delDirRow,i.delDirCol,i.delDis,f),k={board:j[1].set.value,delta:j[2].set.value};d.push({move:j,turnIndexBeforeMove:f,turnIndexAfterMove:1-f,stateBeforeMove:e,stateAfterMove:k,numberOfPlayers:r,comment:{en:i.comment}}),e=k,f=1-f}return d}function j(){return i(0,null,[{row:5,col:5,delDirRow:0,delDirCol:0,delDis:0,comment:"R put at middle of the board"},{row:5,col:6,delDirRow:0,delDirCol:0,delDis:0,comment:"Y put next to it(trying to block it)"},{row:4,col:5,delDirRow:0,delDirCol:0,delDis:0,comment:"R put one on it's neighbor to form two in a row"},{row:3,col:5,delDirRow:0,delDirCol:0,delDis:0,comment:"Y tries to block one side of R"},{row:4,col:6,delDirRow:0,delDirCol:0,delDis:0,comment:"R forms another line on another direction"},{row:3,col:7,delDirRow:0,delDirCol:0,delDis:0,comment:"Y blocks one side of R's new line"},{row:6,col:4,delDirRow:0,delDirCol:0,delDis:0,comment:"R extends the line by adding one on the other direction"},{row:7,col:3,delDirRow:0,delDirCol:0,delDis:0,comment:"Y blocks the other direction as well"}])}function k(){var a=l();return a[5][3]="R",a[5][4]="R",a[5][5]="R",a[6][7]="Y",a[6][3]="Y",a[1][3]="Y",a[4][4]="Y",[i(0,{board:a,delta:{row:4,col:4,delDirRow:0,delDirCol:0,delDis:0}},[{row:5,col:6,delDirRow:0,delDirCol:0,delDis:0,comment:"Find the position for R where he could win in his next turn at either side of a 4-in-a-row line"},{row:5,col:7,delDirRow:0,delDirCol:0,delDis:0,comment:"Y played at the right end"},{row:5,col:2,delDirRow:0,delDirCol:0,delDis:0,comment:"R wins by having three R at the right side of the line."}])]}function l(){for(var a=new Array(11),b=0;11>b;++b){a[b]=new Array(10);for(var c=o[b][0];c<o[b][1];++c)a[b][c]=""}return console.log("board"+a),a}function m(a,b){for(var c=[],d=0;11>d;d++)for(var e=o[d][0];e<o[d][1];e++)try{c.push(g(a,d,e,0,0,0,b))}catch(f){}var h=c[Math.floor(Math.random()*c.length)];return console.log("random move is: ",h[2].set.value.row,h[2].set.value.col),h}var n=5,o=[[0,5],[0,6],[0,7],[0,8],[0,9],[0,10],[1,10],[2,10],[3,10],[4,10],[5,10]],p=[[0,6],[0,7],[0,8],[0,9],[0,10],[1,11],[2,11],[3,11],[4,11],[5,11]],q=[[0,4],[0,3],[0,2],[0,1],[0,0],[1,0],[2,0],[3,0],[4,0],[5,0]],r=2;a.getHorIndex=d,a.getWinner=e,a.createMove=g,a.isMoveOk=h,a.getExampleGame=j,a.getRiddles=k,a.setBoard=l,a.createComputerMove=m}(gameLogic||(gameLogic={}));var game;!function(a){function b(){resizeGameAreaService.setWidthToHeight(1),j=gameLogic.setBoard(),i=new hexagon.IHex,i.HexagonGrid("HexCanvas",50),dragAndDropService.addDragListener("gameArea",f),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:c}),n=document.getElementById("gameArea"),o=document.getElementById("draggingLines"),p=document.getElementById("horizontalDraggingLine"),q=document.getElementById("verticalDraggingLine")}function c(a){t=a,j=a.stateAfterMove.board,k=a.stateAfterMove.delta,void 0===j&&(j=gameLogic.setBoard()),i.drawHexGrid(u,30,30,!1,j),l=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,m=a.turnIndexAfterMove,i.turn=a.yourPlayerIndex,l&&""===a.playersInfo[a.yourPlayerIndex].playerId&&$timeout(e,500)}function d(a){gameService.makeMove(a)}function e(){var a=gameLogic.createComputerMove(j,m);gameService.makeMove(a),i.column=a[2].set.value.col-a[2].set.value.row+5,i.row=Math.round((-4+i.column+2*a[2].set.value.row)/2)}function f(a,b,c){if(""===gameLogic.getWinner(j)){var d=g(b,c).x,e=g(b,c).y;console.log("handleDragEvent="+o),o.style.display="inline";var f=window.innerWidth,k=window.innerHeight,l=b,n=c;if(console.log("handleDragEvent[0] x="+l),console.log("handleDragEvent[0] y="+n),f>k?l-=f/2-k/2:n-=k/2-f/2,console.log("handleDragEvent[1] w="+f),console.log("handleDragEvent[1] h="+k),console.log("handleDragEvent[1] x="+l),console.log("handleDragEvent[1] y="+n),-1!==d&&-1!==e&&(q.setAttribute("x1",l+""),q.setAttribute("x2",l+""),p.setAttribute("y1",n+""),p.setAttribute("y2",n+"")),"touchstart"===a||"touchmove"===a){if(d===r&&e===s||-1===d&&-1===e||0>d||0>e)return;r=d,s=e;var t=0===m?"R":"Y";""===j[d][e]?(j[d][e]=t,i.drawHexGrid(u,30,30,!1,j),j[r][s]=""):i.drawHexGrid(u,30,30,!1,j)}else"touchend"==a&&(-1===d&&-1===e&&(d=r,e=s),h(d,e),o.style.display="none")}}function g(a,b){var c,d,e=window.innerWidth,f=window.innerHeight;e>f?a-=e/2-f/2:b-=f/2-e/2,e>f?(c=a/f,d=b/f):(c=a/e,d=b/e);for(var g,h,i=-1,j=-1,k=.075;.72>k;){if(c>k&&k+.05>c){if(g=Math.floor((c-.075)/.07),5>=g){h=Math.floor((d-(.3-.04*g))/.08),j=h,i=j+(5-g);break}h=Math.floor((d-(.1+.04*(g-5)))/.08),i=h,j=i+(g-5);break}k+=.07}for(var l=!1,k=0;11>k;++k)for(var m=u[k][0];m<u[k][1];++m)if(i===k&&j===m){l=!0;break}return l||(i=-1,j=-1),{x:i,y:j}}function h(a,b){try{var c=gameLogic.createMove(j,a,b,0,0,0,m);l=!1,console.log(JSON.stringify(c)),d(c)}catch(e){return void log.info(["Invalid move:",a,b,e.message])}}var i,j=null,k=null,l=!1,m=0,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=[[0,5],[0,6],[0,7],[0,8],[0,9],[0,10],[1,10],[2,10],[3,10],[4,10],[5,10]];a.init=b}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_BOKU:"Wecome to Boku!",RULES_SLIDE:"Rules: Two players take turns to put pieces on the board \r\n          (black goes first), and the game is won by the player who puts five or \r\n          more pieces into a row first, as is shown here (white wins).",CLOSE:"Close"}),game.init()});var hexagon;!function(a){var b=function(){function a(){}return a.prototype.HexagonGrid=function(a,b){this.radius=b,this.height=Math.sqrt(3)*b,this.width=2*b,this.side=1.5*b,this.canvas=document.getElementById(a),this.context=this.canvas.getContext("2d"),this.canvasOriginX=0,this.canvasOriginY=0},a.prototype.drawHexGrid=function(a,b,c,d,e){this.canvasOriginX=b,this.canvasOriginY=c;for(var f,g,h="",i=!1,j=0;12>j;j++){for(var k=0;12>k;k++){var l=Math.floor((5-j+2*k)/2);0>5-j+2*k&&(l=1e3);var m=l+j-5;i?(f=j*this.side+b,g=k*this.height+c+.5*this.height):(f=j*this.side+b,g=k*this.height+c),d&&(h=g+""),l>=0&&11>l&&("R"!=e[l][m]&&"Y"!=e[l][m]&&""!=e[l][m]||k!=this.row||j!=this.column?"R"==e[l][m]?this.drawHex(f,g,"#000000",h):"Y"==e[l][m]?this.drawHex(f,g,"#FFFFFF",h):""==e[l][m]&&this.drawHex(f,g,"#DF521F",h):(this.animateMove(f,g,(new Date).getTime(),e[l][m]),this.row=-1,this.column=-1))}i=!i}},a.prototype.animateMove=function(a,b,c,d){console.log("animateMove!!");var e=(new Date).getTime(),f=e-c;if(!(f>500)){var g;"R"==d?g="#000000":"Y"==d&&(g="#FFFFFF"),this.drawHex(a,b,g,"false")}},a.prototype.drawHexAtColRow=function(a,b,c){var d=a%2==0?b*this.height+this.canvasOriginY:b*this.height+this.canvasOriginY+this.height/2,e=a*this.side+this.canvasOriginX;this.drawHex(e,d,c,"")},a.prototype.drawHex=function(a,b,c,d){this.context.strokeStyle="#000",this.context.beginPath(),this.context.moveTo(a+this.width-this.side,b),this.context.lineTo(a+this.side,b),this.context.lineTo(a+this.width,b+this.height/2),this.context.lineTo(a+this.side,b+this.height),this.context.lineTo(a+this.width-this.side,b+this.height),this.context.lineTo(a,b+this.height/2),c&&(this.context.fillStyle=c,this.context.fill()),this.context.closePath(),this.context.stroke(),d&&(this.context.font="8px",this.context.fillStyle="#000",this.context.fillText(d,a+this.width/2-this.width/4,b+(this.height-5)))},a.prototype.getRelativeCanvasOffset=function(){for(var a=0,b=0,c=this.canvas;c.offsetParent;)a+=c.offsetLeft,b+=c.offsetTop,c=c.offsetParent;return this.offSetX=a,this.offSetY=b,{x:a,y:b}},a.prototype.getSelectedTile=function(a,b){var c=this.getRelativeCanvasOffset();console.log("mouse: ",a,b),a-=c.x,b-=c.y,a/=this.scale,b/=this.scale,a-=this.tx,b-=this.ty,a-=this.canvasOriginX,b-=this.canvasOriginY;var d=Math.floor(a/this.side),e=Math.floor(d%2==0?Math.floor(b/this.height):Math.floor((b+.5*this.height)/this.height)-1);if(a>d*this.side&&a<d*this.side+this.width-this.side){var f;f.x=d*this.side,f.y=d%2==0?e*this.height:e*this.height+this.height/2;var g;g.x=f.x,g.y=f.y+this.height/2;var h;h.x=f.x+this.width-this.side,h.y=f.y;var i;i.x=a,i.y=b,this.isPointInTriangle(i,f,g,h)&&(d--,d%2!=0&&e--);var j;j=g;var k;k.x=j.x,k.y=j.y+this.height/2;var l;l.x=k.x+(this.width-this.side),l.y=k.y,this.isPointInTriangle(i,j,k,l)&&(d--,d%2==0&&e++)}return{row:e,col:d}},a.prototype.sign=function(a,b,c){return(a.x-c.x)*(b.y-c.y)-(b.x-c.x)*(a.y-c.y)},a.prototype.isPointInTriangle=function(a,b,c,d){var e,f,g;return e=this.sign(a,b,c)<0,f=this.sign(a,c,d)<0,g=this.sign(a,d,b)<0,e==f&&f==g},a.prototype.getIndex=function(a,b){var c=a,d=b,e=this.getSelectedTile(c,d);this.column=e.col,this.row=e.row},a.prototype.updateUI=function(){if(this.column>=0&&this.row>=0){var a=this.column%2==0?this.row*this.height+this.canvasOriginY+6:this.row*this.height+this.canvasOriginY+6+this.height/2,b=this.column*this.side+this.canvasOriginX;1===this.turn?this.drawHex(b,a-6,"rgba(255,0,0,0.4)",""):this.drawHex(b,a-6,"rgba(255,255,0,0.4)","")}},a}();a.IHex=b}(hexagon||(hexagon={}));
//# sourceMappingURL=everything.min.js.map